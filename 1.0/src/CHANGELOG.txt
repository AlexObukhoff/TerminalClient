Версия 1.0.9 build 11

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- не проигрывался прогресс при проверке номера;
- отсылались лишние пакеты статуса устройств на мониторинг, что приводило к его неработоспособности;
- WC разрывал связь на 18 минут при попытке отправки СМС; 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
При создании GPRS соединения, теперь не происходит запрос номера пользователя.

build 7
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- в мониторинг не отправлялась информация о платеже;


build 6
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|

- реализована печать штрих-кода на чеке инкассации для принтеров Custom VKP-80 и Citizen PPU-700.
Для печати штрих-кода в файле конфигурации в разделе принтера необходимо добавить атрибут incass_barcode="1".
Пример: <printer baudrate="0" port="1" incass_barcode="1" ... min_lines_count="0"/> 
Описание данных          Число цифр
общая сумма инкассации       8
количество купюр             4
номер чека инкассации        3

- добавлена проверка данных штрих-кода;
- реализован сторожевой таймер "Экспресс-Оплата"(<watchdog type="expresspay" port=".." />);
- реализована поддержка принтера Startup 900 по параллельному порту(<printer type="startup900lpt" port=".." />);   


------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- не покупались пины в оффлайне не покупались; 
- поправилена печать на принтере Атол;
- при зажевывании купюры, купюроприемник CashCode переходил в состояние ошибки и не возвращался в корректное состояние,после изъятия купюры.
Также это учтено для купюроприемников JCM;
- в некоторых ошибочных ситуациях терминал не блокировался;
- не прописывалась нулевая комиссия при отсутствии тега <comission> в operators.xml; 
- при оплате сдачи на телефон,параметр AMOUNT_ALL для основного пакета был равен всей сумме;
- неправильно вычислялась комиссия в остаточном платеже на мобильного оператора;
- кнопки страниц вылезали за границы экрана, если чисто страниц больше 6. 
Теперь если кнопки вылезают, то положение левой границы ряда вычисляется исходя из размеров экрана, 
количества кнопок и ширины кнопки;

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
В тег <process> в теге <debug> добавлен атрибут conn - если он равен "0",
то conn.exe запускаться не будет. Значение тега log не влияет на атрибут full(если он 1, то пишем полные пути в логах УРЛов).
Значение атрибута url тега <log> по умолчанию 1. Запуск conn перенесен в обработчик таймера process.


build 3
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Доработан драйвер для купюроприемника CashCode - теперь поддерживается сериЯ FL.


build 2
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменен режим работы купюрника MEI - теперь автоматически определяется в каком режиме ему работать( стандартный или расширенный).
Актуально для Казахстанаской и Украинской валюты.

build 1
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена возморжность создавать динамические поля меню.
Под динамическими полями понимают связку из двух полей(они не обязательно должны идти подряд) - parent и child.
Поле parent может быть только типом ENUM.
Тип поля child зависит от текущего значения поля parent.
В зависимости от того, какое значение имеет поле parent (в зависимости от того, на какую кнопку из списка кнопок нажал пользователь), поле child имеет тот или иной тип.

Структура operators.xml

Описание поля parent.
Описание ничем не отличается от описания любого другого поля типа ENUM, кроме добавления 1 дополнительного атрибута.
В атрибуте parentField содержится значение идетификатора поля child.

        <field id="101" type="enum" parentField="<id_поля_child>">
          <name>Тип</name>
         <enum>
                    <item value="1">ENUM</item>
                    <item value="2">MASKED</item>
                    <item value="3">INTEGER</item>
                    <item value="4">TEXT</item>
                </enum>
          <comment>Ваберете тип услуги</comment>
        </field>

Описание поля child.
Атрибут parentValue соответствует значению поля parent
В теге <type> описан тип поля child. Возможные значения: masked, integer, pwd, enum, text, textpwd
В теге <values> описаны атрибуты типа.
Для enum - список кнопок.
Для masked - маска.
Для integer и pwd - минимальная и максимальная длина.
Для text и textpwd - клавиатура по умолчанию.

                <field id="102" type="enum">
                        <name>Выберите код договора</name>
                        <enum>
                                <item parentValue="1">
                                        <type>enum</type>
                                        <values>
                                                <item value="294NK">Договор начинается с "294NK"</item>
                                        </values>
                                </item>
                                <item  parentValue="2">
                                        <type>masked</type>
                                         <values>
                                                <mask>******!-!**</mask>
                                        </values>
                                </item>
                                <item  parentValue="3">
                                         <type>integer</type>
                                        <values>
                                                <minlength>4</minlength>
                                                <maxlength>15</maxlength>
                                        </values>
                                </item>
                                <item  parentValue="4">
                                        <type>text</type>
                                        <values>
                                                <klava>latc</klava>
                                        </values>
                                </item>
                        </enum>
               </field>

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
В файл операторов добавлена опция отображения подложки логотипа - <backing>.
Для отображения подложки необходимо прописать тег <backing> внутри тега <operator>.
Пример:

<operator id="...">
.
. {Описание оператора}
.
<image>image.png</image>
<backing>1</backing>
</operator>

В данном случае у указанного оператора появиться подложка на странице ввода номера и внесения денег.
Отсутствие в описании оператора тега backing или значение, заключенное внутри тега, отличное от 1 НЕ ОТОБРАЖАЕТ подложку.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- при неверно прописанном или отсутствующем WatchDog'е возникал AccessViolation;
- отлажен принтер Штрих-Комбо ФР-К;
- если в файле операторов в теге request-property прописано несколько филдов,
 но между ними нет разделителя (или только между некоторыми филдами нет разделителя), 
в пакете статистики в соответствующее поле писалась некорректная строка;
- при <processor type="External" offline="1"/> шла проверка введенного номера;
 
Ошибки Конфигуратора:
- исправлена ошибка выхода на страницу при неработающем купюроприемнике;
- исправлено двойное создание соединения в addressbook;
- добавлена проверка при редактировании меню (чтобы не удалили элементы);
- устранена задержка между нажатием кнопки генерации ключей и сообщением
об ожидании;
- исправлено ошибочная запись флага offline_payment;
- генерацию ключей можно пропускать;
- исправлен баг с ошибкой эцп;

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика работы с ключами - теперь WebClient работает только с теми ключами, которые были сгенерированы на терминале,
с помощью программы Configurator.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
В дистрибутив включена beta-версия программы наcтройки терминала - Configurator.exe
На данном этапе Конфигуратор возможно будет определять автоматически не все типы устройств.
Просьба сообщать о таких проблемах на terminals@cyberplat.com.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлена обработка атрибута ignored_check_errors_list тега <payments> в фале конфигурации.
В этот тег через запятую либо через пробел пишутся номера ошибок, которые нужно игнорировать при проверке номера.
Список этих ошибок находится в файле db_errors.js.  
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
После разблокирования терминала, при оплате, зависал интерфейс терминала.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
В Записной книжке исправлена проблема с Ростелекомом.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлен отладочный режим работы терминала. Если этот режим включен терминал не обрабатывает ошибочный статус или наличие купюроприемника и принтера.
Для включения отладочного режима в файле конфигурации необходимо прописать теги:
    <debug>  
      <validator>1</validator> 
      <printer>1</printer>
    </debug>  
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Не правильно формировался пакет для отправки на сервер мониторинга.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
После удаления XMLP-пакета, не удалялся временный файл платежа. 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика формирования пакета остатка, при оплате сдачи на телефон.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлена ошибка обработки таймаута при вносе купюры в купюроприемник.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Убрана кнопка генерации ключей в сервисном меню, вместо нее добавлена кнока запуска конфигуратора. 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика обработки ошибочных ситуаций купюроприемника - в интерфейсе, "Записной книжке" и при оплате остатка.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлена проблема в доступе к памяти в драйвере принтера Прим-21К.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены мелкие ошибки интерфейса.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Не осуществлялась деактивация кнопки "ДА", при пустом поле ввода пароля.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки в при продаже ПИНов:
- комиссия при продаже ПИНов считалась два раза.
- не правильно печатались чеки.
- пакет не кидался в папку unprocessed.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
В случае попадания на страницу ошибки или внесения денег со страницы автоопределения номера (оператор 999),
при нажатии на кнопку "НАЗАД", вовращаемся на страницу оператора 999.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
изменена логика удаления пробелов в запросе на сервер.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Некорректно печатались чеки при продаже PIN`ов.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки в "Записной книжке":
- кнопка "ДОБАВИТЬ" не отображалась после заведения 7 записей.
- при онлайн проверке, если номер определялся как неверный, отображалась кнопка "НЕТ", а не "НАЗАД". 
- если запись была создана через web-сайт, то при отображении в WebClient'е вместо точек отображались звёздочки.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
В случае оплаты сдачи на телефон, на странице вноса денег не отображалась кнопка "ОТМЕНИТЬ".
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Увеличен таймаут интерфейса и убрано ошибочное выставление таймаута начальной страницы.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Подправлена проблема с фискальным регистратором Штрих-М.
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
В начале процедуры реализации остатка, в пакете XMLP было столько же купюр, сколько было внесено в основном платеже. 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки в Записной книжке:
- исчезал символ '%' при переходе на поле комментария.
- комментарий налезал на кнопки.
- проблемы с таймаутами. Выставлены следующие таймауты:
60 сек - на странице без ввода данных, 120 сек с момента последнего нажатия на кнопку на странице ввода данных. 
- после вывода сообщения "Невозможно связаться с платёжной системой. Попробуйте позже." осуществлялся произвольный
переход в главное меню.
- кнопка "назад" исчезала только тогда, когда внесенная сумма была больше максимальной.
- при неактивном числовом поле, пропадала надпись "Комиссия".
- некорректно отображалась экранная клавиатура.
- купюроприёмник оставался в активном состоянии, при возврате со страницы оплаты.
- на странице оплаты, надпись "Вы внесли недостаточную сумму!" исчезала одновременно с появлением кнопки оплатить,
когда сумма становилась больше или равной минимальной.
- не работал атрибут printer_ok_only в файле конфигурации операторов.
- не работал атрибут showAddInfo.
- если, при внесённой сумме меньше минимальной, нажать "Оплатить", то осуществлялся переход не в главное меню
Записной книжки, а в главное меню WebClient'а.
- связанные с использользованием специальных символов.
- проблемы перечисления сдачи на телефон.

Исправлены ошибки в WebClient:
- задвоение звука при возврате на предыдущую страницу.
- исправлена ошибка в логике купюроприемника.
- скорректирована работа таймаута платежа.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Доработан движок проигрования звуковых файлов.
Если невозможно проиграть файл с помощью ICM, то он будет проигрываться стандартным winapi. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализован сервис "Записная книжка".
Теперь пользователи терминала могут регистрироваться на терминале или на сайте по адресу: https://note.cyberplat.com,
заводить записи с наиболее часто оплачиваемыми операторами, и оплачивать их через терминал. 
Идентификаторы операторвов(id) в файле operators.xml должны быть уникальны и постоянны, для локальных операторов предлагается
использовать значения начиная с 10000.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализована функция фиксированной оплаты и зачисления излишка на мобильный телефон.
Для возможности принимать фиксированную оплату необходимо в файле operators.xml
в теге <fields> сделать соответствующее поле, у которого должен быть тип integer.
В теге <limit> атрибут fix должен быть равен номеру этого поля.
Пример:
 <operator id="110" cyber_id="16">
      <name>Ростелеком</name>
       ...     
      <limit min="1" max="30000" fix="103"/>
      <fields>
        <field id="100" type="masked">
          <name>Номер телефона</name>
          <mask>#8#8 (***) ***-**-**</mask>
        </field>
        <field id="101" type="masked">
          <name>Дата выставления счета (ДД.ММ.ГГ)</name>
          <mask>**!.!**!.!**</mask>
        </field>
        <field id="102" type="masked">
          <name>Номер счета</name>
          <mask>******! !***! !**</mask>
        </field>
        <field id="103" type="integer" maxlength="8">
          <name>Сумма к оплате (пример: 154.30)</name>
          <comment>Введите точную сумму с копейками, указанную в квитанции.</comment>
        </field>
      </fields> 
      ...  
 </operator>

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена возможность отображения оператором 999 логотипов разных операторов.
Пример из файла operators.xml:
 <group id="100">
      <operator_id id="999" image="mob_mts_espp.png"/>
      <operator_id id="999" image="mob_beeline.png"/>
      <operator_id id="999" image="mob_megafon.png"/>
      <operator_id id="999" image="mob_skylink.png"/>
      <operator_id id="999" image="mob_tele2.png"/>
 </group>

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Для каждого устройства установлена проверка на синтаксическую корректность номера порта.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Построение меню вынесено из файла operators.xml в файл menu.xml.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика отправки пакетов статистики: теперь устаревшие пакеты удаляются, если не отправились в течении часа.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика работы модема.
Настройка параметров соединения (логин/пароль/параметры связи/etc) берутся из настроенного соединения в Windows. 
Первая проверка баланса происходит через 1 час после запуска программы, при этом происходит обрыв существующего
соединения (также как и при отправке смс), получение баланса и восстановление соединения.
Если хосты для проверки связи не пингуются, то соединение сбрасывается и происходит повторный дозвон.
Если превышается лимит попыток установления соединения - сбрасывается питание модема (при установленном сторожевике).

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- при ошибочной строке валидатора в файле конфигурации купюроприемник не инициализировался, однако надпись "Терминал временно не работает" не отображалась. 
- при возврате со страницы оплаты, когда купюра еще не была внесена, купюроприемник оставался в режиме ожидания купюры.
- виртуальная клавиатура: при вводе нескольких символов,после нажатия кнопки "стереть", последний символ затирался, 
однако при вводе n+1 символа он вводился вместо последнего имеющегося. 
- некоректная работа купюроприемника JCM и MEI.
- некоректное отображение ступенчатой комиисии.
- некоректная работа сторожевика ОСМП1.
- при возврате на главную страницу со страницы оплаты происходило двойное промигивание экрана.
- виртуальная клавиатура: при нажатии кнопки ввод исчезала клавиатура.
- ошибки выделения памяти и обработки разрушительных сбоев.
- задвоение пакетов статистики в некоторых случаях.
 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Если оператор в группе представлен в единственном числе - при клике на картинку группы, осуществляеться переход сразу на страницу оплаты существующего в единственном числе оператора. 
Реализовано для кнопок главного меню. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика подгрузки изображений - теперь они кешируются до отображения.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика проведения платежей:если возникает ошибка, то осуществляется сразу переход к следующему пакету.
Если ошибка содержится в самом пакете, то пакет перемещается в папку unprocessed. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
На странице ввода номера, таймер возврата на главную страницу обнуляется после каждого нажатия на кнопку. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Дополнительные возможности по маскированию.
В файле operators.xml для тега <mask><mask> добавлено маскирование с помощью символа '#'.
Запись в маске <mask>#8# 8 (***) ***-**-**</mask> означает запрет ввода восмерки первым символом. 
Т.е. если пользователь нажмет 8, то символ просто не отобразиться на экране. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Введен оператор 100, который позволяет выводить отдельных операторов на кнопки быстрого доступа в шапке главного меню.
Пример использования:


<group id="100" image="" title="" columns="1">
      <operator_id id="0"/>
      <operator_id id="2"/>
      <group id="1200" image="mob_megafon.png" titleimage="" title="МЕГАФОН" columns="4" type="">
          <operator_id id="1" image="mob_megafon_moscow.png"/>
          <operator_id id="4" image="mob_megafon_sz.png"/>
          <operator_id id="5" image="mob_megafon_ural.png"/>
          <operator_id id="6" image="mob_megafon_sib.png"/>
          <operator_id id="7" image="mob_megafon_pvl.png"/>
          <operator_id id="8" image="mob_megafon_centr.png"/>
          <operator_id id="9" image="mob_megafon_dv.png"/>
          <operator_id id="10" image="mob_megafon_kavkaz.png"/>
          <operator_id id="11" image="mob_megafon_yug.png"/>
          <operator_id id="12" image="mob_megafon_tver.png"/>
      </group>
      <group id="1212" image="mob_skylink.png" titleimage="" title="СкайЛинк" columns="2" type="">
          <operator_id id="19" image="mob_skylink_moscow.png"/>
          <operator_id id="45" image="mob_skylink_sz.png"/>
          <operator_id id="46" image="mob_skylink_nnovgorod.png"/>
          <operator_id id="47" image="mob_skylink_ekaterinburg.png"/>
          <operator_id id="48" image="mob_skylink_vladimir.png"/>
          <operator_id id="49" image="mob_skylink_udmurtiya.png"/>
      </group>
	  <operator_id id="21"/>
      </group>
Для того чтобы на кнопке отображался логотип, который лежит в папке logo, он должен быть указан в теге оператора <rootmenuimage></rootmenuimage>. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена ЭЦП для пакетов статистики. При соединении с сервером мониторинга, происходит обмен подписанными сообщениями, если подписи совпали, 
то в том же соединении начинается обмен данными, иначе происходит разрыв соединения стороной, которая обнаружила ошибку подписи. 
Для того, чтобы терминал начал посылать на мониторинг подписанные сообщения, в файле конфигурации config.xml введен 
новый параметр <sign_statistics>1</sign_statistics> установка, которого в 1 принуждает терминал подписывать сообщения статистики и 
проверять, что от сервера, тоже приходит подписанный ответ.
В сервере мониторинга данная возможность включена с версии 1.4. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлен онлайн-параметр для шаблона чека - AUTHCODE.
В ответе от сервера поле AUTHCODE,теперь можно распечатать на чеке. 
Пример ответа (номер тарнзакции Киевстар - в поле AUTHCODE):
    BEGIN DATE=11.02.2008 14:39:02 SESSION=43248 ERROR=0 RESULT=0 TRANSID=1299754 AUTHCODE=2791967
Этот параметр будет выводиться на печать, если он есть в запросе и в шаблоне чека указан этот тэг. 
Для этого в файле operators.xml для нужного оператора в раздел <check> и <payment> необходимо добавить строку:
    <receive-property name="AUTHCODE" description="Код авторизации" /> 

В шаблон чека добавить еще одну строку:
    <String>%RAW_PARAMETER_NAME%: %RAW_PARAMETER_DATA%</String> 
Таких строк в шаблоне чека может быть несколько.
По-умолчанию, в первую записывается номер телефона (поле NUMBER), таким образом, во вторую будет записан AUTHCODE. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена валидация полей в интерфейсе с помощью регулярных выражений.
Для валидации в файле операторов в тэге field надо добавить тэг <regexp></regexp>.
Пример: <field id="100" type="text" klava="latc" minlength="6" maxlength="12">
            <name>Код брони</name>
            <comment>[b]Внимание[/b] Введите код брони. [b]6/b букв или [b]12/b цифр.</comment>
            <regexp>([a-zA-Z]{6})$|(.{12})$</regexp> 
        </field>
В данном примере кнопка "Далее" появляется только если пользователь ввел с клавиатуры 6 букв(регистр не важен) или 12 цифр. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены ошибки:
- если в файле config.xml не прописан принтер,то после проверки номера, и внесения суммы платежа происходило зависание интерфейса. 
- задвоение поля COMMENT в запросах CHECK и PAY
- печать чека баланса: при печати чека баланса из сервисного меню, чек не печатался, в логе сообщается об ошибке: PerformBalance Exception: is not a valid integer value 
Исправлено, если не введен номер валидатора, то испольуется 0 в качестве значения по умолчанию.
- в сервисном меню при нажатии кнопки "Генерация ключей", ключи не генерировались.  
- не определялись устройства, если они были не прописаны в нижнем регистре.
Теперь printer type, validator type protocol, watchdog type, keyboard type,cardreader type, coin_acceptor type, scanner type не чувствительны к регистру. 
- не отображалась информация о балансе SIM карты.
Для правильного отображения баланса нужно после сервисного номера добавлять ";". 
- при вводе данных через виртуальную клавиатуру,если информация вводилась с пробелами, то в запросе на сервер отправлялись невалидные данные.
- при автоопределении номера, последняя цифра не вводилась. 
- отправлялось пустое письмо при инкассации.
- не корректно работал <processor type="External">
- не корректно логировался код ошибки, возвращаемой с сервера при запросе номиналов карт
- не архивировались логи при запросе их с сервера мониторинга
- если во время разбора шаблона чека встречается строка, содержащая одни пробелы или пустую строку, т.е. <String> </String> или <String></String>,
то чек не печатался.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализована возможность работы терминала без купюроприемника, с одним  монетоприемником. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Для корректной печати чека инкассации в файл шаблона чека Incass.xml добавить строки, соответствующие номиналу монет.
 Если есть монеты и купюры равного номинала, то нужно указать:
      <String>Купюры%10BILLNOMINAL%:%10BILLAMOUNT%. Сумма: %10BILLSUMM%</String>
      <String>Монеты%10BILLNOMINAL%:%10BILLAMOUNT%. Сумма: %10BILLSUMM%</String>   
 
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена логика восстановления связи модемом.
Теперь при указании в файле config.xml параметра модема auto_dial="0", 
ничего не делается(в данный момент подключение поднимается),
при auto_dial="1", если соединение установлено, то при запуске оно сбрасывается и поднимается заново.
Если нет соединения, то автоматически оно устанавливается. 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализована полупиновая схема оплаты

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Выбор режима отображения надписи "онлайн" при оплате определенных операторов.
Если указать в теге <processor showOnLineComment="0"/>, то коментарий "Ваш платеж будет проведен в режиме OnLine" отображаться не будет.
По умолчанию данный комментарий выводится.

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Дополнительные возможности по маскированию.
В файле operators.xml в теге <mask><mask> можно задавать параметры маскирования с помощью символов '!' и '~'.

Вид маски               | Введенный номер | Отправится на сервер  | Отобразиться на экране     |      Примечание
 8  (***) ***-**-**      9031234567            9031234567           8 (903) 123-45-67            Показываем, НЕ отправляем
!8! (***) ***-**-**      9031234567           89031234567           8 (903) 123-45-67            Показываем, отправляем 
~8~ (***) ***-**-**      9031234567           89031234567             (903) 123-45-67            НЕ показываем, отправляем

8!33!~505~***-**-**        1234567            335051234567             833123-45-67              Более комплексный пример

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлен параметр для шаблона чека %INT_DEALER_POINT_CODE% (номер точки дилера) <parameters><key_info><keys>AP</keys></key_info></parameters> 

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализовано автоматическое проведение инкассации при снятии стекера купюроприемника.
Для этого необходимо в файле config.xml в тег validator добавить атрибут incass_open_stacker="1" 
Пример: <validator type="CCNet" protocol="wba003" port="1" currency="RUR" exchange_rate="1" currency_name="руб" incass_open_stacker="1"/>

------------------------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Изменена система печати чеков - теперь можно создавать шаблоны не только обычных чеков, но и чеков инкассации.
В инсталляционный пакет включён конвертер старого формата в новый (файл ReceiptConverter.exe). 
Запуск - ReceiptConverter.exe <Путь к каталогу WebClient>. Если конвертер лежит в каталоге WebClient, 
то параметры можно не указывать.
Печатает чеки, шаблоны которых хранятся в XML файле, заменяя псевдопараметры
реальными значениями. Пример шаблона:

<?xml version="1.0" encoding="windows-1251" standalone="no"?>
<body>
        <String>-----------------------------------</String>
        <String>     Дата     Время     Терминал</String>
        <String>  %DATETIME%   %TERMNUMBER%</String>
        <String>Номер сессии : %SESSNUM%</String>
        <String>Сумма        : %AMOUNTALL% %INT_CURRENCY%.</String>
        <String>Комиссия     : %COMISSION% %INT_CURRENCY%.</String>
        <String>К зачислению : %AMOUNT% %INT_CURRENCY%.</String>
        <String>        СПАСИБО, СОХРАНЯЙТЕ ЧЕК</String>
        <String>      ПЛАТЕЖНАЯ СИСТЕМА КИБЕРПЛАТ</String>
</body>

В разное время и для разных чеков действителен разный набор параметров:

Действительны всегда:
%INT_DEALER_NAME%       - Имя дилера
%INT_DEALER_ADDRESS%    - Адрес дилера
%INT_DEALER_INN%        - ИНН дилера
%INT_DEALER_PHONE%      - Телефон дилера
%INT_POINT_ADDRESS%     - Адрес точки приёма платежей
%TERMNUMBER%            - Номер терминала
%INT_CURRENCY%          - Валюта платежа
%INT_CONTRACT_NUMBER%   - Номер контракта
%INT_BANK_NAME%         - Наименование банка
%INT_BANK_BIK%          - БИК банка
%INT_BANK_PHONE%        - Телефон банка

Действительны при выдаче чека оплаты:
%TRANSID%               - Номер транзакции
%SESSNUM%               - Номер сессии
%DATETIME%              - Текущие дата и время
%AMOUNTALL%             - Внесённая сумма
%COMISSION%             - Комиссия
%AMOUNT%                - Сумма на счёт плательщика
%OPNAME%                - Наименование операции
%INT_RECIPIENT_NAME%    - Наименование организации, принявшей платёж
%INT_RECIPIENT_INN%     - ИНН организации, принявшей платёж
Есть возможность задавать параметры в виде пар имя - значение.
Пока только для наименования и суммы платежа.
%RAW_PARAMETER_NAME%: %RAW_PARAMETER_DATA%

Имя файла - шаблона для чека задаётся в файле operators.xml в тэге cheque
operator\cheque\filename без указания пути к файлу

Действительны при выдаче чека инкассации и печати баланса:
%INCASSRECEIPTCOUNTER%  - Порядковый номер чека текущей сессии инкассации (только во время инкассации)
%INCASSPERIODFROM%      - Начало диапазона дат, за который производится инкассация
%CURRENTDATETIME%       - Конец диапазона дат, за который производится инкассация
%KASETTENUMBER%         - Номер кассеты, по которой производится инкассация
%BILLAMOUNT%            - Количество купюр
%TOTALSUMM%             - Общая сумма
%INCASSRECEIPTNUMBER%   - Номер чека
%ACCOUNTBALANCE%        - Баланс на счёте (не для всех чеков)
%<номинал>BILLNOMINAL%  - Имя номинала для купюры, где <номинал> - числовое значение номинала купюры
%<номинал>BILLAMOUNT%   - Количество купюры, где <номинал> - числовое значение номинала купюры
%<номинал>BILLSUMM%     - Сумма по значению купюры, где <номинал> - числовое значение номинала купюры
Имя файлов - incass.xml и balance.xml

При печати чека об ошибке, если внесено достаточно денег
%DATETIME%              - Текущие дата и время
%AMOUNTALL%             - Внесённая сумма
%SESSNUM%               - Номер сессии
%OPNAME%                - Наименование операции
%COMISSION%             - Комиссия
%AMOUNT%                - Сумма на счёт плательщика
Имя файла - шаблона для чека задаётся в файле operators.xml в тэге cheque
operator\cheque\payment_notenoughmoney_filename без указания пути к файлу
  
При печати чека об ошибке, если внесено недостаточно денег
%DATETIME%              - Текущие дата и время
%AMOUNTALL%             - Внесённая сумма
%SESSNUM%               - Номер сессии
%OPNAME%                - Наименование операции
%COMISSION%             - Комиссия
%AMOUNT%                - Сумма на счёт плательщика
Имя файла - шаблона для чека задаётся в файле operators.xml в тэге cheque
operator\cheque\payment_error_filename без указания пути к файлу


Добавлены тэги для шаблонов чеков
%INT_BUSINESS_DEALER_ADDRESS%   - Деловой(Физический) адрес дилера - config.xml\dealer_info\business_dealer_address
%RENT_COMISSION% - остаток пользователя

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализовано маскирование полей при выводе данных на печать, используются регулярные выражения, введен новый тэг cheque_mask с параметрами:
regexp - регулярное выражение по которому будет обрабатываться поле
format - формат выходного выражения

обработка данных производится без маски
если задано
<field id="100" type="masked">
   <mask>8 (***) ***-**-**</mask>
то на чеке печатается только номер без пробелов, ковычек и тд, при составлении регулярного выражения надо опиратся на это, например если
мы хотим вывести только первые 3 цифры куда платит пользователь то надо сделать так:
<cheque_mask regexp="^(.{3}).{7}$" format="8 ($1) ***-**-**" />

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена валидация полей в интерфейсе с помощью регулярных выражений, для валидации в тэге field надо добавить тэг <regexp></regexp>
пример:
<field id="100" type="text" klava="latc"  minlength="6" maxlength="12">
	<name>Код брони</name>
	<comment>[b]Внимание![/b] Введите код брони. [b]6[/b] букв или [b]12[/b] цифр.</comment>
	<regexp>^([a-zA-Z]{6})$|^(.{12})$</regexp>
</field>
в данном примере кнопка "Далее" появляется только если пользователь ввел с клавиатуры 6 букв(регистр не важен) или 12 цифр

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
При теге <processor showOnLineComment="0"/> коментарий "Ваш платеж будет проведен в режиме OnLine" не появляется, по умолчанию данный комментарий 
выводится, реализовано для интерфейсов 2.0 и platina, в других интерфейсах данный комментарий не выводится.

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Реализована полупиновая схема, введен новый processor type="half_pin" - используется для некоторых транснациональных шлюзов(например, T-Mobile).

------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Подправлены баги:
- Не иницилизировались RASDIALPARAMS.szUserName и RASDIALPARAMS.szPassword при пустых <modem login password> из конфига
- Исправлен баг с невозможностью генерирования ключей через сервисное меню
- Исправлен баг, теперь printer type, validator type protocol, watchdog type, keyboard type, cardreader type, coin_acceptor type, scanner type не 
чувствительны к регистру, в коде нужно испльзовать lower case строки для работы с данными типами.
- Убрано задвоение поля COMMENT при запросах CHECK, PAY (Не соответсвует протоколу обмена). Возникало при использовании правил формирования запроса из 
operators.xml, второй COMMENT всегда был равен InitialSession
- кидание exception 11004 в GetCardsInfoThread, опечатка в boost::format

------------------------------------------------------------------------------------------------------------------------------------------------
|INFO|
- Для получения баланса SIM карты, в peripherals\modem\service_number после номера для баланса должен стоять символ точки с запятой - ";"

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена поддержка принтера bd2-0286 (printer type="bd2-286")

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена поддержка принтера "Меркурий MSK (Гепард)" в обычном и фискальных режимах
в обычном режиме    <printer type="mercmsk" port=".." /> 
в фискальном режиме с возможностью записи в буффер    <printer type="mercmsk-frk-buffer" port=".." /> 

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена поддержка сканера шрих-кодов Metrologic Quantum/3480 (scanner type="quantum3480")
в config.xml добавлены строки конфигурации сканера шрих-кодов
<scanner type="" port="" /> 

Изменения файла operators.xml
Для услуг, которым необходима информация считываемая со сканера штрих-кода, добавляется поле с гуидом услуги
<serviceGuid></serviceGuid> 

Для услуги "Коммунальные платежи Москва" добавлен гуид
<serviceGuid>{2F4B68AB-3875-494d-BB9B-2C194F3A1D9D}</serviceGuid>
со штрих кода считывается код абонента и период платежа

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
добавлена поддержка принтера wp-k833 (printer type="wp-k833")

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|  
Добавлена поддержка принтера StarTSP600, в обычном и фискальном режимах   
Star TSP600 в обычном режиме    <printer type="startsp600" port=".." /> 
Star TSP600 в фискальном режиме с возможностью записи в буффер    <printer type="startsp600-frk-buffer" port=".." /> 

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена возможность выводить информацию на терминале, которая передается с сервера в поле запроса ADDINFO.
Для этого у оператора в файле operators.xml необходимо прописать параметр showAddInfo=1
<processor type="Cyberplat" id="1" keys_id="0" offline="0" showAddInfo="1">

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена поддержка монетоприёмника NRI G-13 mft (validator type="nri_g13" protocol="")

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлена возможность инкассации по разным валидаторам отдельно. 

------------------------------------------------------------------------------------------------------------------------------------------------
|BUG|
Исправлены утечки памяти   

------------------------------------------------------------------------------------------------------------------------------------------------
|INFO|
Изменён версионинг софта. В дальнейшем применяется стандартное версионное обозначение.
Релиз кандидат – для выкладывания на сервер, как бета-кандидата на выпуск продукта. По релиз кандидату проводится регрессивное тестирование версии. 
Релиз – для выкладывания на сервер в качестве последней стабильной версии. 
Каждой сборке присваивается версия. Формат версии: версия.подверсия.релиз.билд. С каждым билдом связывается лог изменений со времени последнего билда такого же типа. 
Для тестовой сборки ведётся четырёхциферный версионинг. Последнее значение увеличивается на единицу для каждой следующей сборки.
1.0.8.1, далее 1.0.8.2, и.т.д. Для релиз-кандидата то же самое, но перед инкрементируемой величиной ставится RC. 1.0.8.RC1, далее 1.0.8.RC2. 
Релиз собирается после проверки очередного релиз-кандидата, при отсутствии ошибок выше критичности “Minor”. В версии релиза отсутствует последнее значение.
Например, если версия релиз-кандидата 1.0.8.RC2, то версия релиза, собранного из него будет 1.0.8 

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
Добавлен новый оператор ООО "Авиацентр". Теперь клиенты мировых авиаперевозчиков – компаний "Аэрофлот",
"British Airways", "Alitalia", "KLM Royal Dutch Airlines", "Austrian Airlines", "Air Canada",
"LOT", "Swiss International Airlines" и многих других смогут осуществлять покупку полноценного электронного
билета или оплачивать бронь.

------------------------------------------------------------------------------------------------------------------------------------------------
|INFO|
Если payment_notenoughmoney_filename не указан, но указан payment_error_filename, то будет искользоваться он, если оба тэга не указаны то будет 
использоваться payment-error.xml

------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Убрана возможность снятия комиссии при отрицательных значениях в файле operators.xml. Теперь, если отрицательная комиссия все же будет случайно 
поставлена, то она обнуляется.

------------------------------------------------------------------------------------------------------------------------------------------------
|CHANGE|
Временно отключена возможность настройки config.xml из сервисного меню.

------------------------------------------------------------------------------------------------------------------------------------------------
|NEW|
В чеках можно использовать новый параметр $INT_DEALER_POINT_CODE$ (номер точки дилера).
